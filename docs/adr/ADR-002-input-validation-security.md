- Тесты: tests/test_input_validation.py
# ADR-002: Безопасная валидация входных данных
Дата: 2025-10-19

Статус: Accepted

## Context
Риски инъекций через строковые поля и DoS через большие payloads.

Альтернативы:
- Только Pydantic валидация (недостаточная защита)
- Сторонние библиотеки (дополнительные зависимости)

## Decision
Многоуровневая система валидации:
- Pydantic схемы с кастомными валидаторами для length, pattern, sanitization
- Лимит размера JSON payload: 1MB максимум
- Лимиты полей: title 200 chars, author 100 chars, description 500 chars
- Санитизация: удаление опасных символов (<, >, ;, --)

## Consequences
**Плюсы:** защита от XSS и SQL инъекций, предотвращение DoS через большие данные

**Минусы:** дополнительная обработка запросов

**Trade-offs:** безопасность vs performance

## Links
- NFR-005
- R2, R8, F3, F4
- tests/test_validation.py::test_input_sanitization

## Alternatives

- Делегировать валидацию на следующие уровни (например, СУБД или внешний сервис). Проще на уровне API, но это увеличивает риск неконсистентности и уязвимости.
- Использовать API Gateway или WAF для фильтрации входных данных. Это централизует контроль, но требует дополнительных настроек и может приводить к ложным срабатываниям.

## План внедрения и критерии приёмки

- Добавить валидации Pydantic и убедиться, что тесты из `tests/test_input_validation.py` проходят.
- Включить проверку размера payload (middleware) и проверить, что большой payload отклоняется.
- Описать поддерживаемые Content-Type и правила предварительной фильтрации.
