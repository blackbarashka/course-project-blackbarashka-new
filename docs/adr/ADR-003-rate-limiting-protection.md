# ADR-003: Ограничение частоты запросов (rate limiting)
Дата: 2025-10-19

Статус: Accepted

## Контекст
Сервис может стать целью DoS-атак или брутфорса, если не ограничивать частоту запросов. Для защиты требуется механизм, который будет ограничивать количество запросов от одного источника за заданный интервал.

## Решение
На уровне приложения внедрить простой in-memory лимитер как промежуточный слой (middleware):
- Ограничение для POST /api/v1/books: 10 запросов в минуту на один IP.
- Общий лимит для всех endpoints: 100 запросов за окно в 60 секунд на IP (параметр для настройки).
- При превышении возвращать 429 и заголовок Retry-After.

## Последствия
- Защита от простых DoS-атак и чрезмерной нагрузки от отдельных клиентов.
- In-memory решение простое, но не распределяемое; для кластеров потребуется внешнее хранилище (Redis).

## Альтернативы
- Полагаться на лимиты на уровне API Gateway — удобно в продакшене, но не всегда доступно в тестовой среде.
- Внедрить распределённый лимитер на Redis (token bucket) — подходит для масштабируемых развёртываний, но добавляет инфраструктуру.

## План внедрения и критерии приёмки
- Добавить RateLimitMiddleware и покрыть тестами (tests/test_rate_limiting.py).
- В логах отслеживать частоту 429 и при необходимости корректировать пороги.
- Для боевого окружения подготовить план перехода на Redis-backed лимитер, если потребуется масштабирование.

## Ссылки
- NFR-003, NFR-004
- Тесты: tests/test_rate_limiting.py::test_rate_limiting_protection
